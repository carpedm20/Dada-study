<script type="text/javascript"> 

var border_color = '#378006'

$(document).ready(function() {
  var options = "";

  for (var i=0; i<student_list.length; i++) {
    options += (i+1) + " : " + student_list[i] + "  ";
  }
  
  var date = new Date();
  var d = date.getDate();
  var m = date.getMonth();
  var y = date.getFullYear();
  
  var calendar = $('#calendar').fullCalendar({
    header: {
      left: 'prev,next today',
      center: 'title',
      right: 'month,agendaWeek,agendaDay'
    },

    selectable: true,
    selectHelper: true,
    eventColor: border_color,

    editable: true,

    eventClick: function(calEvent, jsEvent, view) {
      $(this).css('border-color', 'red');

      var title = calEvent.title.split('-')[0].trim();
      var isDelete = confirm('Are you sure to delete "' + title + '"');
      
      if (isDelete) {
        jQuery.post(
          '{% url 'delete_event' study_group_id='0' %}',
          {
            id: calEvent.id,
          }
        );
        $(this).remove()
      } else {
        $(this).css('border-color', border_color);
      }
      //alert('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);
      //alert('View: ' + view.name);

      // change the border color just for fun
    },
    eventDrop: function(event, dayDelta, minuteDelta, allDay, revertFunc) {
      if (!confirm("Are you sure about this change?")) {
        revertFunc();
      } else {
        jQuery.post(
          '{% url 'edit_event' study_group_id='0' %}',
          {
            id: event.id,
            dayDelta: dayDelta,
            minuteDelta: minuteDelta,
          }
        );
      }
    },
    events: function(start, end, callback) {
      $.ajax({
        url: '{% url 'get_event' study_group_id='0' %}',
        dataType: 'json',
        data: {
          // our hypothetical feed requires UNIX timestamps
          //start: Math.round(start.getTime() / 1000),
          //end: Math.round(end.getTime() / 1000)
        },
        success: function(data) {
          var events = [];
          $(data).each(function() {
            var student_list = $(this).attr('student_list');
            student_list = student_list.split(',')

            var student_list_as_string = '';

            for(var i=0; i<student_list.length; i++) {
              student_list[i] = student_list[i].split('@')[0];
              student_list_as_string += student_list[i] + ", ";
            }

            if (student_list.length > 0)
              student_list_as_string = student_list_as_string.substr(0, student_list_as_string.length - 2);

            events.push({
              // title: $(this).attr('title') + "\r\n" + student_list,
              id: $(this).attr('id'),
              title: $(this).attr('title') + " - " + student_list_as_string,
              start: $(this).attr('start'),
              end: $(this).attr('end'),
              allDay: $(this).attr('allDay'),
              //student_list: $(this).attr('student_list'),
            });
          });
          callback(events);
        }
      });
    },
  });
  
});

</script>
