{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content_with_nav %}

    <div class="container-fluid">
      <div class="row">
        {% include "navbar.html" %}
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <!--<h1 class="page-header">Welcome {{ user.username }}!</h1>-->

          <div class="list-group">
            <div class="list-group-item active">
              <h4 class="list-group-item-heading">
                To-do
              </h4>
            </div>
            <div class="list-group-item">
              <div class="text-center">
                {% if event_finished_percent == -1 %}
                  <p>할일이 없어요 :|</p>
                {% elif event_finished_percent != 100 %}
                  <p>아직 할일이 남았어요 :(</p>
                {% else %}
                  <p>할일을 모두 끝내셨군요 :)</p>
                {% endif %}
              </div>
              <div class="progress">
                {% if event_finished_percent != 100 %}
                  <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="{{ finished_event_count }}" aria-valuemin="0" aria-valuemax="{{ total_event_count }}" style="width: {{ event_finished_percent }}%;">
                {% else %}
                  <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{ finished_event_count }}" aria-valuemin="0" aria-valuemax="{{ total_event_count }}" style="width: {{ event_finished_percent }}%;">
                {% endif %}
                  <span class="sr-only">60% Complete</span>
                </div>
              </div>
            </div>
            {% for event in user.student.assigned_to.all %}
              <div class="list-group-item">
                {% if user.student in event.finished_student.all %}
                  <button type="button" class="btn btn-success btn-lg pull-right" onclick="location.href='{% url 'unfinish_event' study_group_id=event.study_group.unique_id event_id=event.id %}'">
                    <span class="glyphicon glyphicon-ok"></span> Done
                  </button>
                {% else %}
                  <button type="button" class="btn btn-info btn-lg pull-right" onclick="location.href='{% url 'finish_event' study_group_id=event.study_group.unique_id event_id=event.id %}'">
                    Finished?
                  </button>
                {% endif %}
                <h4 class="list-group-item-heading">
                  <a href="{% url 'core:view_study_group' event.study_group.unique_id %}"> {{ event.name }} </a>
                </h4>
                <p class="list-group-item-text">
                  {% if event.is_all_day %}
                    {{ event.get_all_day }} |
                  {% else %}
                    {{ event.get_start_as_korean }} ~ {{ event.get_end_as_korean }} |
                  {% endif %}
                  <a href="{% url 'core:view_study_group' event.study_group.unique_id %}">{{ event.study_group }}</a>
              </div>
            {% endfor %}
          </div>

          <div class="list-group">
            <div class="list-group-item active">
              <h4 class="list-group-item-heading">
                Study Group list
              </h4>
            </div>
            {% for group in study_group_list %}
              {% if group.is_private and user.student not in group.student_set.all %}
              {% else %}
                {% if group.is_private %}
                  <div class="list-group-item list-group-item-private">
                {% else%}
                  <div class="list-group-item">
                {% endif %}
                  <button type="button" class="btn btn-info btn-lg pull-right">
                    <span class="glyphicon glyphicon-bookmark"></span> Bookmark
                  </button>

                  <form role="form" action="{% url 'core:join_study_group' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" value="{{ group.unique_id}}" name="group_unique_id">
                    {% if group.isJoined %}
                      <button type="submit" class="group-join-btn btn btn-success btn-lg pull-right" style="margin-right: 10px;">
                        Joined
                    {% else %}
                      <button type="submit" class="group-join-btn btn btn-primary btn-lg pull-right" style="margin-right: 10px;">
                        Join
                    {% endif %}
                    </button>
                  </form>

                  <h4 class="list-group-item-heading">
                    <a href="{% url 'core:view_study_group' group.unique_id %}">
                      {% if group.is_private and user.student in group.student_set.all %}
                        <span class="glyphicon glyphicon-eye-close"></span>
                      {% else %}
                        <span class="glyphicon glyphicon-eye-open"></span>
                      {% endif %}
                      {{ group.name }}
                    </a>
                  </h4>
                  <p class="list-group-item-text">
                    {{ group.details }} | 그룹장 : 
                    <a href="#">
                      {% if group.creator == user.student %}
                        <span class="badge badge-me">{{ group.creator.get_id }}</span>
                      {% elif group.creator in user.student.friends.all %}
                        <span class="badge badge-friend">{{ group.creator.get_id }}</span>
                      {% else %}
                        <span class="badge">{{ group.creator.get_id }}</span>
                      {% endif %}
                    </a>
                    {% if group.tag_set.all.count > 0 %}
                      | 태그 : 
                      {% for tag in group.tag_set.all %}
                        <span class="badge">{{ tag }}</span>, 
                      {% endfor %}
                    {% endif %}
                  </p>

                  <!--<span class="glyphicon glyphicon-chevron-right"></span>
                  <span class="badge">{{ group.student_set.all | length }}</span>-->
                </div>
              {% endif %}
            {% endfor %}
          </div>

          <div class="list-group">
            <div class="list-group-item active">
              <h4 class="list-group-item-heading">
                User list
              </h4>
            </div>
            {% for student in student_list %}
              <div class="list-group-item">
                <form role="form" action="{% url 'account:follow' %}" method="post">
                  {% csrf_token %}
                  <input type="hidden" value="{{ student }}" name="username">
                    {% if student.isFriend %}
                  <button type="submit" class="student-follow-btn btn btn-success btn-lg pull-right">
                      <span class="glyphicon glyphicon-star"></span> Friend
                    {% else %}
                  <button type="submit" class="student-follow-btn btn btn-primary btn-lg pull-right">
                      <span class="glyphicon glyphicon-star-empty"></span> Follow
                    {% endif %}
                  </button>
                </form>

                <h4 class="list-group-item-heading">
                  <a href="#"> {{ student }} </a>
                </h4>
                <p class="list-group-item-text">
                  {{ student.school }} | 

                  {% for study_group in student.studygroup_set.all %}
                    {% if not study_group.is_private %}
                      <a href="{% url 'core:view_study_group' study_group.unique_id %}">{{ study_group }}</a>, 
                    {% endif %}
                  {% endfor %}
                </p>

                <!--<span class="glyphicon glyphicon-chevron-right"></span>
                <span class="badge">{{ group.student_set.all | length }}</span>-->
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

{% endblock %}
